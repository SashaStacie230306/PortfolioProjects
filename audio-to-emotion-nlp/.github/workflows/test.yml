# Tests for a Python project using Poetry, PyTorch, Transformers, and Safetensors
name: Run Tests

on: [pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository with Git LFS support
        uses: actions/checkout@v3
        with:
          lfs: true

      - name: Pull Git LFS files
        run: git lfs pull

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Poetry
        run: |
          curl -sSL https://install.python-poetry.org | python3 -
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: Configure Poetry
        run: poetry config virtualenvs.create false

      - name: Cache Poetry dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pypoetry
          key: poetry-${{ hashFiles('**/poetry.lock') }}
          restore-keys: |
            poetry-

      - name: Install project dependencies
        run: poetry install

      - name: Install PyTorch (CPU-only for CI)
        run: |
          pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

      - name: Install compatible Transformers and Safetensors versions
        run: |
          pip install transformers==4.40.1 safetensors==0.4.2

      - name: Run tests
      if: false
      run: poetry run pytest -n auto --maxfail=1 --disable-warnings -v
